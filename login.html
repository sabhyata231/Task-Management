<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login | App</title>
    <link rel="stylesheet" href="style1.css" />
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
      #userInfo {
        display: none;
        margin-top: 15px;
        padding: 10px;
        background: #f5f5f5;
        border-radius: 8px;
        align-items: center;
        gap: 12px;
      }
      #userPic {
        width: 40px;
        height: 40px;
        border-radius: 50%;
      }
    </style>
  </head>
  <body>
    <header>
      <div class="logo">IP Tech Project Management</div>
      <div class="signup-top">
        Don’t have an account?
        <a href="signup.html">
          <button>Sign Up</button>
        </a>
      </div>
    </header>

    <div class="container">
      <h2>Welcome back!</h2>

      <!-- Google Login -->
      <div
        id="g_id_onload"
        data-client_id="46776826227-bd620j3t8butomicsf4566fcnba66j0q.apps.googleusercontent.com"
        data-context="signin"
        data-ux_mode="popup"
        data-callback="handleCredentialResponse"
        data-auto_prompt="false"
      ></div>

      <div
        id="googleBtn"
        class="g_id_signin"
        data-type="standard"
        data-shape="rectangular"
        data-theme="outline"
        data-text="continue_with"
        data-size="large"
        data-logo_alignment="left"
      ></div>

      <!-- User info shown after login -->
      <div id="userInfo">
        <img id="userPic" src="" alt="Profile Picture" />
        <span id="userEmail"></span>
      </div>

      <div class="or">OR</div>

      <form id="loginForm">
        <div class="input-box">
          <label for="email">Work Email</label>
          <input
            type="email"
            id="email"
            placeholder="Enter your work email"
            required
          />
        </div>

        <div class="input-box">
          <label for="password">Password</label>
          <input
            type="password"
            id="password"
            placeholder="Enter password"
            required
          />
        </div>

        <div class="forgot">
          <a href="forgot.html">Forgot Password?</a>
        </div>

        <button type="submit" class="btn">Log In</button>
      </form>

      <div class="signup">
        Don’t have an account? <a href="signup.html">Sign Up</a>
      </div>
    </div>

    <script>
      // Decode JWT token to get user info
      function decodeJwtResponse(token) {
        let base64Url = token.split(".")[1];
        let base64 = base64Url.replace(/-/g, "+").replace(/_/g, "/");
        let jsonPayload = decodeURIComponent(
          atob(base64)
            .split("")
            .map(function (c) {
              return "%" + ("00" + c.charCodeAt(0).toString(16)).slice(-2);
            })
            .join("")
        );
        return JSON.parse(jsonPayload);
      }

      // Callback after Google login
      function handleCredentialResponse(response) {
        const data = decodeJwtResponse(response.credential);
        const email = data.email;
        const picture = data.picture;
        const name = data.name;

        // Show profile info
        document.getElementById("userInfo").style.display = "inline-flex";
        document.getElementById("userPic").src = picture;
        document.getElementById("userEmail").textContent = email;

        // Optional: change button text
        let googleBtn = document.getElementById("googleBtn");
        googleBtn.innerHTML = `<div style="display:flex; align-items:center; gap:8px;">
    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" style="width:20px; height:20px;">
    Continue as ${name}
  </div>`;

        // ✅ Redirect to dashboard
        window.location.href = "main_dashboard.html";
      }

      // Handle email/password login
      document
        .getElementById("loginForm")
        .addEventListener("submit", function (e) {
          e.preventDefault(); // stop form refresh

          // You can add validation or API check here
          const email = document.getElementById("email").value;
          const password = document.getElementById("password").value;

          if (email && password) {
            // ✅ Redirect to dashboard
            window.location.href = "main_dashboard.html";
          } else {
            alert("Please enter valid credentials!");
          }
        });
    </script>
  </body>
</html>
