<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login | App</title>
    <link rel="stylesheet" href="style1.css" />
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
      #userInfo {
        display: none;
        margin-top: 15px;
        padding: 10px;
        background: #f5f5f5;
        border-radius: 8px;
        align-items: center;
        gap: 12px;
      }
      #userPic {
        width: 40px;
        height: 40px;
        border-radius: 50%;
      }

      .input-box {
        position: relative;
        display: flex;
        flex-direction: column;
      }

      .input-box input {
        width: 100%;
        padding: 10px 40px 10px 10px; /* space for the button on right */
        font-size: 14px;
      }

      .input-box button {
        position: absolute;
        right: 10px;
        top: 70%;
        transform: translateY(-50%);
        background: none;
        border: none;
        cursor: pointer;
        color: #007bff;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <header>
      <div class="logo">IP Tech Project Management</div>
      <div class="signup-top">
        Already playing with ClickUp?
        <a href="login.html">
          <button>Login</button>
        </a>
      </div>
    </header>

    <div class="container">
      <h2>Seconds to Sign Up!</h2>

      <!-- Google Login -->
      <div
        id="g_id_onload"
        data-client_id="46776826227-bd620j3t8butomicsf4566fcnba66j0q.apps.googleusercontent.com"
        data-context="signin"
        data-ux_mode="popup"
        data-callback="handleCredentialResponse"
        data-auto_prompt="false"
      ></div>

      <div
        id="googleBtn"
        class="g_id_signin"
        data-type="standard"
        data-shape="rectangular"
        data-theme="outline"
        data-text="continue_with"
        data-size="large"
        data-logo_alignment="left"
      ></div>

      <!-- User info shown after login -->
      <div id="userInfo">
        <img id="userPic" src="" alt="Profile Picture" />
        <span id="userEmail"></span>
      </div>

      <div class="or">OR</div>

      <form id="signupForm">
        <div class="input-box">
          <label for="name">Full Name</label>
          <input type="name" id="name" placeholder="John Doe" required />
        </div>

        <div class="input-box">
          <label for="email">Work Email</label>
          <input
            type="email"
            id="email"
            placeholder="example@gmail.com"
            required
          />
        </div>

        <div class="input-box">
          <label for="password">Choose Password</label>
          <input
            type="password"
            id="password"
            placeholder="Minimum 8 characters"
            required
          />
          <button type="button" id="togglePassword">Show</button>
        </div>

        <button type="button" id="playBtn" class="btn">Play with ClickUp</button>
      </form>
    </div>

    <script>
      let isGoogleUser = false; // track login method

      // Decode JWT token to get user info
      function decodeJwtResponse(token) {
        let base64Url = token.split(".")[1];
        let base64 = base64Url.replace(/-/g, "+").replace(/_/g, "/");
        let jsonPayload = decodeURIComponent(
          atob(base64)
            .split("")
            .map(function (c) {
              return "%" + ("00" + c.charCodeAt(0).toString(16)).slice(-2);
            })
            .join("")
        );
        return JSON.parse(jsonPayload);
      }

      // Callback after login
      function handleCredentialResponse(response) {
        const data = decodeJwtResponse(response.credential);
        const email = data.email;
        const picture = data.picture;

        // Show profile info
        document.getElementById("userInfo").style.display = "inline-flex";
        document.getElementById("userPic").src = picture;
        document.getElementById("userEmail").textContent = email;

        // Directly redirect to dashboard
        window.location.href = "dashboard.html";

        // Mark that user used Google
        isGoogleUser = true;

        // Update Play button
        const playBtn = document.getElementById("playBtn");
        playBtn.textContent = "Play with ClickUp";
        playBtn.disabled = false;
      }

      // Handle Play button click
      document.getElementById("playBtn").addEventListener("click", () => {
        const playBtn = document.getElementById("playBtn");

        if (isGoogleUser) {
          // Google flow
          playBtn.textContent = "Searching...";
          playBtn.disabled = true;
          setTimeout(() => {
            window.location.href = "dashboard.html";
          }, 2000);
        } else {
          // Manual form flow
          const name = document.getElementById("name").value.trim();
          const email = document.getElementById("email").value.trim();
          const password = document.getElementById("password").value.trim();

          if (name && email && password) {
            window.location.href = "validate_login.html";
          } else {
            alert("Please fill all fields!");
          }
        }
      });

      // Password show/hide toggle
      const passwordInput = document.getElementById("password");
      const toggleBtn = document.getElementById("togglePassword");

      toggleBtn.addEventListener("click", () => {
        const isPassword = passwordInput.type === "password";
        passwordInput.type = isPassword ? "text" : "password";
        toggleBtn.textContent = isPassword ? "Hide" : "Show";
      });
    </script>
  </body>
</html>
